#!/usr/bin/env bash
set -eu

function show_cmd() {
  # Use 2>/dev/null with tput to silence this headless error: "tput: No value for $TERM and no -T specified"
  black="$(tput setaf 0 2>/dev/null || true)"
  off="$(tput sgr0 2>/dev/null || true)"
  echo -e "$black\$" "$@" "$off" >&2
  "$@"
}

# Backend (python)
[ -f .venv/pyvenv.cfg ] || show_cmd uv venv .venv
[ -f .venv/.installed ] || (show_cmd uv pip install -r requirements.txt && touch .venv/.installed)
show_cmd ruff check .
show_cmd ruff format --check .
show_cmd pyright

# Frontend (ts, css)
[ -f node_modules/.package-lock.json ] || show_cmd npm install
show_cmd npx biome check frontend/
